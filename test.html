<!DOCTYPE html>

<html>
    <head>
        <title>20-20-20 Rule</title>
        <script type="text/javascript" src="js/stopwatch.js"></script>
        <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen"/>
        <link href="main.css" rel="stylesheet" media="screen"/>
        <script src="js/jquery-1.10.2.min.js"></script>
        <script src="bootstrap/js/bootstrap.min.js"></script>

    </head>

    <body>
    <div class="container">
        <div id="watchText">Time to next break:</div>
        <div id="watchDisplay">Watch's display (handeled by JavaScript)</div>
    </div>
        <script>
            window.watch = new Stopwatch(function(watch) { // Listener function
                document.getElementById('watchDisplay').innerHTML = watch.toString();
            } , 1000, false);

            /* When normalPeriod is 1, the user can carry on his tasks on computer, but when it
             * is 0, we'll alert the user to not look at the screen and relax his/her eyes. */
            window.isNormalPeriod = 1;  // used as boolean
            window.normalPeriodLength = 1000 * 60 * 20;    // 20 minutes
            window.relaxPeriodLength = 1000 * 20;          // 20 seconds

            window.soundFile1 = "sounds/bing.mp3";
            window.soundFile2 = "sounds/bong.mp3";

            //temporary values 
            normalPeriodLength = 1000 * 10; relaxPeriodLength = 1000 * 2;

            var watchTextValues = ["Don't look at the screen!!", "Time to next break:"];

            setInterval('loop()', normalPeriodLength);

            window.watch.setElapsed(0, 00, window.normalPeriodLength/1000);
            document.getElementById('watchDisplay').innerHTML = window.watch.toString();
            window.watch.start();

            function loop() {
                resetWatch(window.normalPeriodLength);
                executeBothTasksWithDelay();
            }

            function resetWatch(timeMilliSec) {
                window.watch.stop();
                window.watch.setElapsed(0, 0, timeMilliSec/1000);
                window.watch.start();
                document.getElementById('watchDisplay').innerHTML = window.watch.toString();
            }

            function executeBothTasksWithDelay() {
                playSound(window.soundFile1);
                resetWatch(window.relaxPeriodLength);
                toggleDisplay();
                setTimeout(function(){
                    playSound(window.soundFile2);
                    resetWatch(window.normalPeriodLength - window.relaxPeriodLength);
                    toggleDisplay();
                }, window.relaxPeriodLength);
            }

            function playSound(filename){
                var sound=new Audio(filename);
                sound.play();
            }

            function toggleDisplay() {
                if(isNormalPeriod==1) {
                    isNormalPeriod = 0;
                    document.getElementById('watchDisplay').style.color = "#FF3366";
                } else {
                    isNormalPeriod = 1;
                    document.getElementById('watchDisplay').style.color = "#008080";
                }
                document.getElementById('watchText').innerHTML = watchTextValues[isNormalPeriod];
            }


        </script>
    </body>
</html>
