<!DOCTYPE html>

<html>
    <head>
        <title>20-20-20 Rule</title>
        <script type="text/javascript" src="js/stopwatch.js"></script>
        <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen"/>
        <link href="main.css" rel="stylesheet" media="screen"/>
        <script src="js/jquery-1.10.2.min.js"></script>
        <script src="bootstrap/js/bootstrap.min.js"></script>

    </head>

    <body>
    <div class="container">
        <div id="watchText">Time to next break:</div>
        <div id="watchDisplay">Watch's display (handeled by JavaScript)</div>
        <button type="button" class="btn btn-primary" id="resetButton" onclick="window.startAfresh()">Reset clock</button>

<!--         <form class="form-horizontal" role="form">
 -->            <div class="form-group">
                <label for="inputEmail3" class="col-sm-2 control-label">Normal working period (minutes)</label>
                <div class="col-sm-10">
                    <input class="form-control" id="inputEmail3" placeholder="20">
                </div>
            </div>
            <div class="form-group">
                <label for="inputPassword3" class="col-sm-2 control-label">Duration of break (seconds)</label>
                <div class="col-sm-10">
                    <input class="form-control" id="inputPassword3" placeholder="20">
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
<!--                     <div class="checkbox">
                        <label>
                            <input type="checkbox"> Remember me
                        </label>
                    </div>
 -->                </div>
            </div>    
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button  class="btn btn-default" onclick="modifyTimes()">Apply</button>
                </div>
            </div>
        <!-- </form> -->

    </div>
        <script>
            window.watch = new Stopwatch(function(watch) { // Listener function
                document.getElementById('watchDisplay').innerHTML = watch.toString();
            } , 1000, false);

            /* When normalPeriod is 1, the user can carry on his tasks on computer, but when it
             * is 0, we'll alert the user to not look at the screen and relax his/her eyes. */
            window.isNormalPeriod = 1;  // used as boolean
            window.normalPeriodLength = 1000 * 60 * 20;    // 20 minutes
            window.relaxPeriodLength = 1000 * 20;          // 20 seconds
            //temporary values 
            window.normalPeriodLength = 1000 * 10; window.relaxPeriodLength = 1000 * 2;

            window.soundFile1 = new Audio("sounds/bing.ogg");
            window.soundFile2 = new Audio("sounds/bong.ogg");

            var watchTextValues = ["Don't look at the screen!!", "Time to next break:"];

            window.startAfresh = function() {
                setDisplayForBool(window.isNormalPeriod);
                clearIntervalsAndTimeouts();
                resetWatch(window.normalPeriodLength);
                window.alreadySetInterval = setInterval('loop()', window.normalPeriodLength);
            }

            window.startAfresh();

            function modifyTimes() {
                window.normalPeriodLength = 1000*60*parseInt(document.getElementById('inputEmail3').value);
                window.relaxPeriodLength = 1000*parseInt(document.getElementById('inputPassword3').value);
                console.log(window.normalPeriodLength);
                console.log(window.relaxPeriodLength);
                console.log(document.getElementById('inputEmail3').value);
                console.log(document.getElementById('inputPassword3').value);
                window.startAfresh();
            }

            function clearIntervalsAndTimeouts() {
                clearInterval(window.alreadySetInterval);
                clearTimeout(window.alreadySetTimeout);
            }

            function loop() {
                resetWatch(window.normalPeriodLength);
                executeBothTasksWithDelay();
            }

            function resetWatch(timeMilliSec) {
                window.watch.stop();
                window.watch.setElapsed(0, 0, timeMilliSec/1000);
                window.watch.start();
                document.getElementById('watchDisplay').innerHTML = window.watch.toString();
            }

            function executeBothTasksWithDelay() {
                window.soundFile1.play();
                resetWatch(window.relaxPeriodLength);
                setDisplayForBool(0);
                window.alreadySetTimeout = setTimeout(function(){
                    window.soundFile2.play();
                    resetWatch(window.normalPeriodLength - window.relaxPeriodLength);
                    setDisplayForBool(1);
                }, window.relaxPeriodLength);
            }

            function setDisplayForBool(boolVal) {
                if(boolVal==1) {
                    watchColour = "#008080";
                } else if(boolVal==0) {
                    watchColour = "#FF3366";
                }
                document.getElementById('watchDisplay').style.color = watchColour;
                document.getElementById('watchText').innerHTML = watchTextValues[boolVal];
            }

        </script>
    </body>
</html>
